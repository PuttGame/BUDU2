<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#000000">
    <title>BUDU2</title>
    
    <link rel="manifest" href="/BUDU2/manifest.json">
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            touch-action: none;
            font-family: system-ui, -apple-system, sans-serif;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }

        #fixed-container {
            position: fixed;
            inset: 0;
            margin: auto;
            width: 100%;
            height: 100%;
            max-width: 2400px;
            max-height: 1080px;
            aspect-ratio: 2400 / 1080;
            background: #000;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.7);
        }

        .screen-img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            opacity: 0;
            pointer-events: none;
            will-change: opacity;
        }

        #watermark-img { z-index: 2; transition: opacity 1s ease-in-out; }
        #loadscreen-img { z-index: 3; }
        #home-img { z-index: 4; }

        #bubu-gif {
            position: absolute;
            bottom: 0.5vh;               /* ← diturunin lagi, hampir nempel bawah */
            left: 50%;
            transform: translateX(-50%);
            width: 45vw;
            max-width: 600px;
            height: auto;
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            image-rendering: crisp-edges;
        }

        #loading-overlay {
            position: absolute;
            bottom: 5vh;
            right: 5vw;
            display: none;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-size: 14px;
            font-weight: 400;
            z-index: 10;
            text-shadow: 0 0 8px rgba(0,0,0,0.8);
        }
        .spinner {
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        #pc-warning {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.95);
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            z-index: 9999;
            font-size: 18px;
        }

        #landscape-hint {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 16px;
            display: none;
            z-index: 100;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="fixed-container">
        <div id="app">
            <img id="watermark-img" class="screen-img" src="/BUDU2/assets/watermark.png" alt="Watermark">
            <img id="loadscreen-img" class="screen-img" src="/BUDU2/assets/loadscreen.png" alt="Loadscreen">
            <img id="home-img" class="screen-img" src="/BUDU2/assets/home.png" alt="Home">
        </div>
        
        <img id="bubu-gif" src="/BUDU2/assets/bubu.gif" alt="Bubu">

        <div id="loading-overlay">
            <div class="spinner"></div>
            <span>loading</span>
        </div>
        
        <div id="pc-warning">
            <div>
                <h2>⚠️ Hanya untuk ponsel</h2>
                <p>Buka di Android landscape 2400×1080.<br>Install via menu Chrome ⋮ → Install app untuk pengalaman terbaik.</p>
            </div>
        </div>
        
        <div id="landscape-hint">
            Putar ponsel ke mode landscape
        </div>
    </div>

    <audio id="music" src="/BUDU2/assets/music1.mp3" preload="auto" loop></audio>

    <script>
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        function checkOrientation() {
            document.getElementById('landscape-hint').style.display = 
                (window.innerWidth < window.innerHeight) ? 'block' : 'none';
        }
        
        async function forceFullscreenAndLandscape() {
            try { await document.documentElement.requestFullscreen(); } catch (e) {}
            try { await screen.orientation?.lock('landscape-primary'); } catch (e) {}
        }
        
        function preloadImages() {
            const srcs = [
                '/BUDU2/assets/watermark.png',
                '/BUDU2/assets/loadscreen.png',
                '/BUDU2/assets/home.png',
                '/BUDU2/assets/bubu.gif'
            ];
            return Promise.all(srcs.map(src => new Promise(resolve => {
                const img = new Image();
                img.onload = resolve;
                img.onerror = () => { console.error('Gagal load:', src); resolve(); };
                img.src = src;
            })));
        }
        
        async function startSequence() {
            const wm = document.getElementById('watermark-img');
            const ls = document.getElementById('loadscreen-img');
            const hm = document.getElementById('home-img');
            const bubu = document.getElementById('bubu-gif');
            const overlay = document.getElementById('loading-overlay');
            const audio = document.getElementById('music');
            
            wm.style.opacity = ls.style.opacity = hm.style.opacity = bubu.style.opacity = '0';
            
            await new Promise(r => setTimeout(r, 3000));
            wm.style.opacity = '1';
            setTimeout(() => wm.style.opacity = '0', 3000);
            await new Promise(r => setTimeout(r, 4000));
            await new Promise(r => setTimeout(r, 3000));
            ls.style.opacity = '1';
            await new Promise(r => setTimeout(r, 5000));
            overlay.style.display = 'flex';
            await new Promise(r => setTimeout(r, 10000));
            ls.style.opacity = '0';
            overlay.style.display = 'none';
            hm.style.opacity = '1';
            bubu.style.opacity = '1';
            
            try { await audio.play(); } 
            catch { document.body.addEventListener('touchstart', () => audio.play(), {once: true}); }
            
            forceFullscreenAndLandscape();
        }

        window.onload = async () => {
            if (!isMobileDevice()) {
                document.getElementById('pc-warning').style.display = 'flex';
                return;
            }
            
            await preloadImages();
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            window.addEventListener('beforeinstallprompt', e => {
                e.preventDefault();
                console.log('PWA installable via Chrome menu');
            });
            
            startSequence();
            setTimeout(forceFullscreenAndLandscape, 1500);
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/BUDU2/sw.js', {scope: '/BUDU2/'})
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.error('SW error:', err));
            }
        };
    </script>
</body>
</html>
