<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#000000">
    <title>BUDU2</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/BUDU2/manifest.json">
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html, body { width:100%; height:100%; overflow:hidden; background:#000; touch-action:none; font-family:system-ui, -apple-system, sans-serif; }
        .full-screen { position:fixed; top:0; left:0; width:100vw; height:100vh; background:#000; z-index:1; }
        .screen-img { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:contain; opacity:0; transition:opacity 1s ease-in-out; pointer-events:none; }
        #watermark-img { z-index:2; }
        #loadscreen-img { z-index:3; }
        #home-img { z-index:4; }
        #loading-overlay { position:fixed; bottom:5vh; right:5vw; display:none; align-items:center; gap:12px; color:#fff; font-size:14px; font-weight:400; z-index:10; text-shadow:0 0 8px rgba(0,0,0,0.8); }
        .spinner { width:22px; height:22px; border:3px solid rgba(255,255,255,0.3); border-top:3px solid #fff; border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin { to { transform:rotate(360deg); } }
        #pc-warning { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); color:white; display:none; align-items:center; justify-content:center; text-align:center; padding:20px; z-index:9999; font-size:18px; }
        #landscape-hint { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.9); color:white; padding:15px 25px; border-radius:10px; font-size:16px; display:none; z-index:100; text-align:center; }
    </style>
</head>
<body>
    <div class="full-screen" id="app">
        <img id="watermark-img" class="screen-img" src="/BUDU2/assets/watermark.png" alt="Watermark">
        <img id="loadscreen-img" class="screen-img" src="/BUDU2/assets/loadscreen.png" alt="Loadscreen">
        <img id="home-img" class="screen-img" src="/BUDU2/assets/home.png" alt="Home">
    </div>
    
    <div id="loading-overlay">
        <div class="spinner"></div>
        <span>loading</span>
    </div>
    
    <div id="pc-warning">
        <div>
            <h2>⚠️ Website ini hanya untuk ponsel</h2>
            <p>Buka di ponsel Android landscape 2400×1080.<br>Install via menu Chrome (⋮) → Install app untuk pengalaman terbaik.</p>
        </div>
    </div>
    
    <div id="landscape-hint">
        Putar ponsel Anda ke mode landscape
    </div>
    
    <audio id="music" src="/BUDU2/assets/music1.mp3" preload="auto" loop></audio>

    <script>
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        function checkOrientation() {
            const hint = document.getElementById('landscape-hint');
            if (window.innerWidth < window.innerHeight) {
                hint.style.display = 'block';
            } else {
                hint.style.display = 'none';
            }
        }
        
        async function forceFullscreenAndLandscape() {
            if (document.documentElement.requestFullscreen) {
                try { await document.documentElement.requestFullscreen(); } catch (e) {}
            }
            if (screen.orientation && screen.orientation.lock) {
                try { await screen.orientation.lock('landscape-primary'); } catch (e) {}
            }
        }
        
        function preloadImages() {
            const images = [
                '/BUDU2/assets/watermark.png',
                '/BUDU2/assets/loadscreen.png',
                '/BUDU2/assets/home.png'
            ];
            return Promise.all(images.map(src => new Promise(resolve => {
                const img = new Image();
                img.onload = resolve;
                img.onerror = () => console.error('Gagal load gambar:', src);
                img.src = src;
            })));
        }
        
        async function startSequence() {
            const watermark = document.getElementById('watermark-img');
            const loadscreen = document.getElementById('loadscreen-img');
            const home = document.getElementById('home-img');
            const loadingOverlay = document.getElementById('loading-overlay');
            const audio = document.getElementById('music');
            
            watermark.style.opacity = '0';
            loadscreen.style.opacity = '0';
            home.style.opacity = '0';
            
            await new Promise(r => setTimeout(r, 3000));
            watermark.style.opacity = '1';
            setTimeout(() => { watermark.style.opacity = '0'; }, 3000);
            await new Promise(r => setTimeout(r, 4000));
            await new Promise(r => setTimeout(r, 3000));
            loadscreen.style.opacity = '1';
            await new Promise(r => setTimeout(r, 5000));
            loadingOverlay.style.display = 'flex';
            await new Promise(r => setTimeout(r, 10000));
            loadscreen.style.opacity = '0';
            loadingOverlay.style.display = 'none';
            await new Promise(r => setTimeout(r, 800));
            home.style.opacity = '1';
            
            try {
                await audio.play();
                console.log('Musik diputar');
            } catch (err) {
                console.log('Autoplay diblokir, tunggu touch');
                document.body.addEventListener('touchstart', () => audio.play().catch(() => {}), { once: true });
            }
            
            forceFullscreenAndLandscape();
        }

        window.onload = async () => {
            if (!isMobileDevice()) {
                document.getElementById('pc-warning').style.display = 'flex';
                return;
            }
            
            await preloadImages();
            
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            // Cegah mini-infobar otomatis agar tidak ganggu UI
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                console.log('PWA siap installable – cek menu Chrome ⋮ untuk "Install app"');
            });
            
            startSequence();
            
            setTimeout(forceFullscreenAndLandscape, 1000);
            
            // Register Service Worker dengan scope eksplisit
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/BUDU2/sw.js', { scope: '/BUDU2/' })
                    .then(reg => {
                        console.log('Service Worker terdaftar sukses, scope:', reg.scope);
                    })
                    .catch(err => {
                        console.error('Gagal register SW:', err);
                    });
            } else {
                console.warn('Service Worker tidak didukung di browser ini');
            }
        };
    </script>
</body>
</html>
