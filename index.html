<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#000000">
    <title>BUDU2</title>
    
    <link rel="manifest" href="/BUDU2/manifest.json">
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            touch-action: none;
            font-family: system-ui, -apple-system, sans-serif;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }

        /* Container utama: dikunci persis 2400√ó1080, centered, tidak boleh keluar */
        #fixed-container {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 2400px;
            height: 1080px;
            transform: translate(-50%, -50%);
            background: #0a1f3a;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(0,0,0,0.9);
            z-index: 1;
        }

        /* Semua elemen harus di dalam container ini, tidak boleh overflow */
        .screen-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            opacity: 0;
            pointer-events: none;
        }

        #watermark-img { z-index: 2; transition: opacity 1s ease-in-out; }
        #loadscreen-img { z-index: 3; }
        #home-img { z-index: 4; }

        /* Karakter utama (bubu.gif / hero) tetap di dalam container */
        #hero-character {
            position: absolute;
            bottom: 0.5vh;
            left: 50%;
            transform: translateX(-50%);
            width: 55vw;
            max-width: 900px;
            height: auto;
            max-height: 80%; /* batasi agar tidak melebihi tinggi container */
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            image-rendering: crisp-edges;
        }

        /* UI Overlay: semua elemen diletakkan relatif container */
        .ui-overlay {
            position: absolute;
            inset: 0;
            overflow: hidden; /* mencegah overflow */
            pointer-events: none;
            z-index: 10;
        }

        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            color: white;
            font-size: 20px;
            pointer-events: auto;
        }

        .top-left { display: flex; align-items: center; gap: 20px; flex-shrink: 0; }
        .level-badge {
            background: #ffd700;
            color: #000;
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: bold;
        }

        .stats { display: flex; gap: 30px; flex-wrap: nowrap; }

        .left-sidebar, .right-sidebar {
            position: absolute;
            top: 100px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            pointer-events: auto;
            max-height: calc(1080px - 200px); /* batasi tinggi agar tidak keluar container */
            overflow: hidden;
        }

        .left-sidebar { left: 20px; }
        .right-sidebar { right: 20px; }

        .menu-btn {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            backdrop-filter: blur(6px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .bottom-bar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            pointer-events: auto;
            max-width: 100%;
        }

        .btn-big {
            padding: 18px 50px;
            font-size: 24px;
            font-weight: bold;
            border: none;
            border-radius: 60px;
            color: white;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            white-space: nowrap;
        }

        .btn-stage { background: linear-gradient(135deg, #00ff88, #00cc66); }
        .btn-fight  { background: linear-gradient(135deg, #ff3366, #cc0033); }

        .chat-bubble {
            position: absolute;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            color: #000;
            padding: 14px 30px;
            border-radius: 40px;
            font-size: 20px;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            pointer-events: none;
            max-width: 80%;
        }

        #loading-overlay {
            position: absolute;
            bottom: 5vh;
            right: 5vw;
            display: none;
            align-items: center;
            gap: 12px;
            color: #fff;
            font-size: 14px;
            z-index: 20;
        }

        #pc-warning, #landscape-hint {
            position: absolute;
            inset: 0;
            z-index: 30;
            display: none;
        }
    </style>
</head>
<body>
    <div id="fixed-container">
        <div id="app">
            <img id="watermark-img" class="screen-img" src="/BUDU2/assets/watermark.png" alt="Watermark">
            <img id="loadscreen-img" class="screen-img" src="/BUDU2/assets/loadscreen.png" alt="Loadscreen">
            <img id="home-img" class="screen-img" src="/BUDU2/assets/home.png" alt="Home">
        </div>
        
        <img id="hero-character" src="/BUDU2/assets/bubu.gif" alt="Hero">

        <div class="ui-overlay">
            <div class="top-bar">
                <div class="top-left">
                    <div class="level-badge">Lv.24</div>
                    <div class="stats">
                        <div class="stat">‚ö° 24/50</div>
                        <div class="stat">ü™ô 4,000</div>
                        <div class="stat">üíé 2,000</div>
                    </div>
                </div>
                <div>‚öôÔ∏è</div>
            </div>

            <div class="left-sidebar">
                <div class="menu-btn">üê±</div>
                <div class="menu-btn">üõí</div>
                <div class="menu-btn">üéí</div>
                <div class="menu-btn">üèÖ</div>
            </div>

            <div class="right-sidebar">
                <div class="menu-btn">üèÜ</div>
                <div class="menu-btn">üì•</div>
                <div class="menu-btn">üìú</div>
                <div class="menu-btn">üéÅ</div>
            </div>

            <div class="bottom-bar">
                <button class="btn-big btn-stage">STAGE</button>
                <button class="btn-big btn-fight">FIGHT</button>
            </div>

            <div class="chat-bubble">Let's play together.. üêä</div>
        </div>

        <div id="loading-overlay">
            <div class="spinner"></div>
            <span>loading</span>
        </div>
        
        <div id="pc-warning">
            <div>
                <h2>‚ö†Ô∏è Hanya untuk ponsel</h2>
                <p>Buka di Android landscape 2400√ó1080.<br>Install via menu Chrome ‚ãÆ ‚Üí Install app.</p>
            </div>
        </div>
        
        <div id="landscape-hint">
            Putar ponsel ke mode landscape
        </div>
    </div>

    <audio id="music" src="/BUDU2/assets/music1.mp3" preload="auto" loop></audio>

    <script>
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        function checkOrientation() {
            document.getElementById('landscape-hint').style.display = 
                (window.innerWidth < window.innerHeight) ? 'block' : 'none';
        }
        
        async function forceFullscreenAndLandscape() {
            try { await document.documentElement.requestFullscreen(); } catch (e) {}
            try { await screen.orientation?.lock('landscape-primary'); } catch (e) {}
        }
        
        function preloadImages() {
            const srcs = [
                '/BUDU2/assets/watermark.png',
                '/BUDU2/assets/loadscreen.png',
                '/BUDU2/assets/home.png',
                '/BUDU2/assets/bubu.gif'
            ];
            return Promise.all(srcs.map(src => new Promise(resolve => {
                const img = new Image();
                img.onload = resolve;
                img.onerror = () => { console.error('Gagal load:', src); resolve(); };
                img.src = src;
            })));
        }
        
        async function startSequence() {
            const wm = document.getElementById('watermark-img');
            const ls = document.getElementById('loadscreen-img');
            const hm = document.getElementById('home-img');
            const hero = document.getElementById('hero-character');
            const overlay = document.getElementById('loading-overlay');
            const audio = document.getElementById('music');
            
            wm.style.opacity = ls.style.opacity = hm.style.opacity = hero.style.opacity = '0';
            
            await new Promise(r => setTimeout(r, 3000));
            wm.style.opacity = '1';
            setTimeout(() => wm.style.opacity = '0', 3000);
            await new Promise(r => setTimeout(r, 4000));
            await new Promise(r => setTimeout(r, 3000));
            ls.style.opacity = '1';
            await new Promise(r => setTimeout(r, 5000));
            overlay.style.display = 'flex';
            await new Promise(r => setTimeout(r, 10000));
            ls.style.opacity = '0';
            overlay.style.display = 'none';
            hm.style.opacity = '1';
            hero.style.opacity = '1';
            
            try { await audio.play(); } 
            catch { document.body.addEventListener('touchstart', () => audio.play(), {once: true}); }
            
            forceFullscreenAndLandscape();
        }

        window.onload = async () => {
            if (!isMobileDevice()) {
                document.getElementById('pc-warning').style.display = 'flex';
                return;
            }
            
            await preloadImages();
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            window.addEventListener('beforeinstallprompt', e => {
                e.preventDefault();
                console.log('PWA installable via Chrome menu');
            });
            
            startSequence();
            setTimeout(forceFullscreenAndLandscape, 1500);
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/BUDU2/sw.js', {scope: '/BUDU2/'})
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.error('SW error:', err));
            }
        };
    </script>
</body>
</html>
